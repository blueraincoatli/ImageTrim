# 图片处理工具套件项目

## 项目概述

这是一个现代化的多功能图片处理工具套件，目前包含图片去重和AVIF格式转换功能，并采用插件化架构支持未来功能扩展。项目目标是提供统一、易用的图片处理解决方案。

### 当前状态
- **现有版本**：置信度版图片去重工具（ImageDedupUI_Confidence.py）
- **新架构版本**：已完成插件化功能系统和现代化UI框架
- **已实现功能**：图片去重、AVIF格式转换
- **目标架构**：采用ttkbootstrap实现3栏式布局的现代化UI，使用插件化功能模块

### 主要技术栈
- **Python 3.8+**: 主要开发语言
- **tkinter**: 基础GUI框架
- **ttkbootstrap**: 现代化UI框架
- **PIL/Pillow**: 图片处理
- **pillow-avif-plugin**: AVIF格式支持
- **numpy**: 数值计算
- **PyInstaller**: 打包工具

## 项目结构

```
E:\FFOutput\Dedup\
├── ImageDedupUI_Confidence.py    # 现有置信度版主程序
├── convert_to_avif.py            # AVIF格式转换工具
├── function_modules.py           # 插件化功能模块系统
├── modern_ui_framework.py        # 现代化UI框架
├── build_confidence_exe.py       # 构建脚本
├── ImageDedup_Confidence.spec    # PyInstaller配置
├── version_info.txt             # 版本信息
├── CLAUDE.md                    # Claude Code 项目指导文档
├── IFLOW.md                     # 项目说明文件（本文件）
├── dist/                        # 打包输出目录
└── docs/                        # 项目文档目录
    ├── UI设计文档.md            # 3栏式UI设计文档
    ├── 现有代码分析.md          # 现有代码结构分析
    ├── 新代码框架设计.md        # 插件化架构设计
    └── 详细开发计划.md          # 开发计划
```

## 现有功能

### 已实现功能
#### 图片去重功能
- **多维度置信度计算**：综合图片相似度、文件名相似度和文件大小相似度
- **批量选择和处理**：支持单组处理模式和批量选择模式
- **重复图片检测**：精确匹配（基于哈希）和相似匹配（基于内容）
- **缩略图预览**：显示图片缩略图和文件信息
- **文件操作**：删除和移动重复文件

#### AVIF格式转换功能
- **批量格式转换**：支持JPG/PNG到AVIF格式转换
- **质量调节**：可设置压缩质量（默认85%）
- **目录结构保持**：保持原目录结构进行转换
- **文件名冲突处理**：自动处理重名文件
- **详细进度反馈**：实时显示转换进度和状态

#### 置信度评估系统
- **图片相似度权重**：60%
- **文件名相似度权重**：20%
- **文件大小相似度权重**：20%
- **置信度分级**：高（>0.8）、中（0.5-0.8）、低（<0.5）

### 预留功能扩展
- **批量重命名**：支持批量文件重命名功能
- **图片优化**：图片质量和大小优化
- **更多格式支持**：WebP、HEIC等现代格式
- **批量处理**：更多批量操作功能

## 新架构特性

### 插件化功能系统
- **BaseFunctionModule**：标准化功能模块基类
- **FunctionManager**：统一功能管理器
- **动态注册**：支持运行时添加和移除功能
- **UI自动生成**：每个功能自动生成对应的UI面板

### 现代化UI框架
- **3栏式布局**：
  - 左栏（20%）：功能选择列表
  - 中栏（25%）：设置控制和进度显示
  - 右栏（55%）：主要功能工作区域
- **ttkbootstrap主题**：深色主题，现代化视觉效果
- **功能热切换**：无需重启即可切换功能
- **统一体验**：所有功能都有一致的用户界面

### 扩展性设计
- **新功能添加**：继承BaseFunctionModule即可
- **独立开发**：每个功能模块可独立开发和测试
- **配置管理**：每个功能都有独立的设置系统
- **回调机制**：支持UI状态实时同步

## 架构对比

### 原有架构特点
- **单一文件设计**：所有功能在一个文件中实现
- **紧耦合**：UI和业务逻辑高度耦合
- **扩展困难**：添加新功能需要修改核心代码
- **测试复杂**：难以进行单元测试

### 新架构优势
- **模块化设计**：功能模块独立，松耦合
- **易于扩展**：新功能无需修改现有代码
- **可测试性**：每个模块可独立测试
- **维护性好**：清晰的代码结构和接口
- **用户体验**：统一的界面和操作方式

## 构建和运行

### 环境要求
- Python 3.8+
- 基础依赖：PIL/Pillow, numpy
- 现代化UI（可选）：ttkbootstrap
- AVIF支持：pillow-avif-plugin

### 运行不同版本
```bash
# 运行现有单一文件版本
python ImageDedupUI_Confidence.py

# 运行新的模块化版本（推荐）
python modern_ui_framework.py

# 运行AVIF转换功能
python convert_to_avif.py

# 测试功能模块系统
python function_modules.py
```

### 打包配置
- **现有版本**：使用PyInstaller进行打包
  - 配置文件：`ImageDedup_Confidence.spec`
  - 输出：单文件exe，无控制台窗口
  - 版本信息：`version_info.txt`
- **新版本**：需要创建新的打包配置
  - 支持ttkbootstrap主题
  - 包含所有功能模块

## 开发约定

### 代码风格
- 遵循PEP 8 Python代码风格指南
- 使用类型提示提高代码可读性
- 类名使用驼峰命名法，函数和变量使用下划线命名法
- 添加适当的注释和文档字符串

### 功能模块开发规范
- 继承BaseFunctionModule创建新功能
- 实现必需的抽象方法：`get_ui_panel()`, `execute()`, `validate_params()`
- 保持功能模块的独立性，避免模块间直接依赖
- 使用回调机制进行UI状态更新

### 测试规范
- 单元测试覆盖率目标：80%+
- 使用pytest进行测试
- 测试文件命名：`test_*.py`
- 每个功能模块应该有对应的测试

### 文档规范
- 所有公共API必须有文档字符串
- 重要设计决策记录在docs目录
- 代码变更及时更新相关文档
- 新功能需要更新CLAUDE.md文档

## 项目文档

### 核心文档
- **CLAUDE.md**：Claude Code项目指导文档，包含完整的开发指南
- **IFLOW.md**：项目总体说明和架构介绍（本文件）

### 设计文档
- **UI设计文档.md**：详细的3栏式UI设计规范，包含布局、交互和视觉风格
- **新代码框架设计.md**：插件化架构设计，包含模块划分和接口定义
- **详细开发计划.md**：开发计划，包含任务分解和时间安排

### 分析文档
- **现有代码分析.md**：对现有代码结构的深入分析，包含优缺点和重构建议

## 关键决策记录

### 插件化架构选择
- **决策**：采用插件化功能模块系统
- **原因**：支持功能扩展，保持代码清晰和可维护性
- **影响**：新功能无需修改核心代码，提高开发效率

### UI框架选择
- **决策**：采用ttkbootstrap替代传统tkinter
- **原因**：提供现代化主题和组件，更好的视觉效果和用户体验
- **影响**：需要学习新的UI框架，但能显著提升应用外观

### 架构模式选择
- **决策**：从单一文件重构为模块化架构
- **原因**：提高代码可维护性、可测试性和扩展性
- **影响**：需要重构现有代码，但长期来看更有利于项目发展

### 功能扩展策略
- **决策**：优先实现图片去重和AVIF转换功能
- **原因**：这两个功能有明确的需求和用户价值
- **影响**：为后续功能扩展建立良好的架构基础

## 后续规划

### 短期目标
- 完善现有功能的UI集成
- 添加批量重命名功能
- 实现图片优化功能
- 完善测试覆盖率

### 中期目标
- 支持更多图片格式（WebP、HEIC）
- 添加图片编辑功能（裁剪、旋转）
- 实现设置持久化
- 添加多语言支持

### 长期目标
- 升级到Python 3.10+
- 实现Web版本
- 支持移动端
- 开发插件系统

### 技术升级
- 性能优化：大文件处理速度提升
- 用户体验：更多快捷键和手势操作
- 云存储：集成云存储服务支持
- 批量处理：更强大的批量操作功能

## 联系信息

- **项目类型**：桌面应用程序
- **开发语言**：Python
- **目标平台**：Windows
- **许可证**：未指定
- **架构**：插件化功能模块系统

---

*最后更新：2025年9月*