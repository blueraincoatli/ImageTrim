# Nuitka CI/CD è¿ç§»æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•ä» PyInstaller è¿ç§»åˆ° Nuitka è¿›è¡Œ GitHub Actions è‡ªåŠ¨ç¼–è¯‘ã€‚

## ğŸ¯ ä¸ºä»€ä¹ˆè¿ç§»åˆ° Nuitkaï¼Ÿ

### PyInstaller çš„é—®é¢˜
- âŒ **TOC æ ¼å¼é”™è¯¯**: `ImageTrim_windows.spec` ä¸­çš„ TOC æ¡ç›®æ ¼å¼ä¸æ­£ç¡®
- âŒ **ç»´æŠ¤å›°éš¾**: `.spec` æ–‡ä»¶é…ç½®å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™
- âŒ **å¯åŠ¨è¾ƒæ…¢**: éœ€è¦è§£å‹å’ŒåŠ è½½ Python è¿è¡Œæ—¶
- âŒ **ä½“ç§¯è¾ƒå¤§**: åŒ…å«å®Œæ•´çš„ Python è§£é‡Šå™¨

### Nuitka çš„ä¼˜åŠ¿
- âœ… **åŸç”Ÿç¼–è¯‘**: Python â†’ C â†’ æœºå™¨ç ï¼Œæ€§èƒ½æ›´ä¼˜
- âœ… **å¯åŠ¨æ›´å¿«**: 2-3 å€å¯åŠ¨é€Ÿåº¦æå‡
- âœ… **é…ç½®ç®€å•**: å‘½ä»¤è¡Œå‚æ•°ï¼Œæ— éœ€å¤æ‚çš„ spec æ–‡ä»¶
- âœ… **æ›´ç¨³å®š**: åŸç”Ÿç¼–è¯‘å‡å°‘è¿è¡Œæ—¶é”™è¯¯
- âœ… **ä½“ç§¯ä¼˜åŒ–**: æ›´å¥½çš„ä»£ç ä¼˜åŒ–å’Œå‹ç¼©

## ğŸ”§ æ–°çš„å·¥ä½œæµæ–‡ä»¶

### æ–‡ä»¶ä½ç½®
```
.github/workflows/build-nuitka.yml
```

### è§¦å‘æ¡ä»¶
1. **Tag æ¨é€**: æ¨é€ `v*` æ ‡ç­¾æ—¶è‡ªåŠ¨è§¦å‘
2. **æ‰‹åŠ¨è§¦å‘**: åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è¿è¡Œ

## ğŸ“¦ æ”¯æŒçš„å¹³å°

| å¹³å° | è¾“å‡ºæ–‡ä»¶ | æ ¼å¼ |
|------|----------|------|
| **Windows** | `ImageTrim.exe` | å•æ–‡ä»¶å¯æ‰§è¡Œæ–‡ä»¶ |
| **macOS** | `ImageTrim.app/` + `.dmg` | åº”ç”¨ç¨‹åºåŒ… + ç£ç›˜é•œåƒ |
| **Linux** | `ImageTrim` + `.AppImage` | å•æ–‡ä»¶ + ä¾¿æºç‰ˆ |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: æ¨é€ Tagï¼ˆæ¨èï¼‰

```bash
# 1. åˆ›å»ºå¹¶æ¨é€ tag
git tag v1.2.0
git push origin v1.2.0

# 2. GitHub Actions è‡ªåŠ¨å¼€å§‹ç¼–è¯‘
# 3. ç¼–è¯‘å®Œæˆåè‡ªåŠ¨åˆ›å»º Release
```

### æ–¹æ³• 2: æ‰‹åŠ¨è§¦å‘

1. è®¿é—® GitHub ä»“åº“çš„ **Actions** é¡µé¢
2. é€‰æ‹© **Build with Nuitka (Multi-Platform)** å·¥ä½œæµ
3. ç‚¹å‡» **Run workflow**
4. è¾“å…¥ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰
5. ç‚¹å‡» **Run workflow** ç¡®è®¤

## âš™ï¸ ç¼–è¯‘å‚æ•°è¯´æ˜

### Windows ç¼–è¯‘å‚æ•°
```bash
--standalone                    # ç‹¬ç«‹æ¨¡å¼
--onefile                       # å•æ–‡ä»¶è¾“å‡º
--assume-yes-for-downloads      # è‡ªåŠ¨ä¸‹è½½ä¾èµ–ï¼ˆå¦‚ MinGWï¼‰
--enable-plugin=pyqt6           # PyQt6 æ’ä»¶
--include-package=pillow_avif   # AVIF æ”¯æŒ
--include-package=send2trash    # åˆ é™¤æ–‡ä»¶æ”¯æŒ
--windows-disable-console       # ç¦ç”¨æ§åˆ¶å°çª—å£
--windows-icon-from-ico=...     # è®¾ç½®å›¾æ ‡
--lto=yes                       # é“¾æ¥æ—¶ä¼˜åŒ–
--remove-output                 # åˆ é™¤ä¸­é—´æ–‡ä»¶
```

### Linux ç¼–è¯‘å‚æ•°
```bash
# ä¸ Windows ç±»ä¼¼ï¼Œä½†ä¸åŒ…å« --windows-* å‚æ•°
# é¢å¤–éœ€è¦ç³»ç»Ÿä¾èµ–ï¼šgcc, g++, ccache, patchelf
```

### macOS ç¼–è¯‘å‚æ•°
```bash
# ä¸ Linux ç±»ä¼¼ï¼Œé¢å¤–åŒ…å«ï¼š
--macos-create-app-bundle       # åˆ›å»º .app åŒ…
--macos-app-icon=...            # è®¾ç½®åº”ç”¨å›¾æ ‡
```

## ğŸ“Š ç¼–è¯‘æ—¶é—´å¯¹æ¯”

| å¹³å° | PyInstaller | Nuitka | å·®å¼‚ |
|------|-------------|--------|------|
| **Windows** | ~5-10 åˆ†é’Ÿ | ~20-25 åˆ†é’Ÿ | æ…¢ 2-3 å€ |
| **Linux** | ~5-10 åˆ†é’Ÿ | ~15-20 åˆ†é’Ÿ | æ…¢ 2 å€ |
| **macOS** | ~5-10 åˆ†é’Ÿ | ~20-25 åˆ†é’Ÿ | æ…¢ 2-3 å€ |

**æ³¨æ„**: Nuitka ç¼–è¯‘æ—¶é—´æ›´é•¿ï¼Œä½†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ€§èƒ½æ›´ä¼˜ã€‚

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: Windows ç¼–è¯‘å¤±è´¥ - æ‰¾ä¸åˆ°ç¼–è¯‘å™¨

**ç—‡çŠ¶**:
```
Error: No C compiler found
```

**è§£å†³æ–¹æ¡ˆ**:
- Nuitka ä¼šè‡ªåŠ¨ä¸‹è½½ MinGW ç¼–è¯‘å™¨ï¼ˆé¦–æ¬¡éœ€è¦ 5-10 åˆ†é’Ÿï¼‰
- ç¡®ä¿ `--assume-yes-for-downloads` å‚æ•°å­˜åœ¨
- æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### é—®é¢˜ 2: Linux ç¼–è¯‘å¤±è´¥ - ç¼ºå°‘ç³»ç»Ÿä¾èµ–

**ç—‡çŠ¶**:
```
Error: gcc not found
Error: patchelf not found
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
sudo apt-get update
sudo apt-get install -y build-essential gcc g++ ccache patchelf
```

### é—®é¢˜ 3: macOS ç¼–è¯‘å¤±è´¥ - Xcode æœªå®‰è£…

**ç—‡çŠ¶**:
```
Error: xcrun: error: invalid active developer path
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
xcode-select --install
```

### é—®é¢˜ 4: æ¨¡å—å¯¼å…¥å¤±è´¥

**ç—‡çŠ¶**:
```
ModuleNotFoundError: No module named 'pillow_avif'
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ `--include-package=pillow_avif` å‚æ•°
- æ£€æŸ¥ `--include-module=pillow_avif._avif` å‚æ•°
- ç¡®ä¿ `requirements.txt` ä¸­åŒ…å«è¯¥æ¨¡å—

### é—®é¢˜ 5: èµ„æºæ–‡ä»¶ç¼ºå¤±

**ç—‡çŠ¶**:
```
FileNotFoundError: resources/icons/...
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ `--include-data-dir` å‚æ•°
- ç¡®ä¿èµ„æºç›®å½•å­˜åœ¨ï¼š`app/resources/icons/`, `app/resources/images/`

## ğŸ“ ä¸ PyInstaller çš„å¯¹æ¯”

### é…ç½®å¤æ‚åº¦
| æ–¹é¢ | PyInstaller | Nuitka |
|------|-------------|--------|
| **é…ç½®æ–‡ä»¶** | éœ€è¦ `.spec` æ–‡ä»¶ | ä»…éœ€å‘½ä»¤è¡Œå‚æ•° |
| **ç»´æŠ¤éš¾åº¦** | é«˜ï¼ˆTOC æ ¼å¼æ˜“é”™ï¼‰ | ä½ï¼ˆå‚æ•°æ¸…æ™°ï¼‰ |
| **è°ƒè¯•éš¾åº¦** | ä¸­ç­‰ | è¾ƒä½ |

### æ€§èƒ½å¯¹æ¯”
| æŒ‡æ ‡ | PyInstaller | Nuitka |
|------|-------------|--------|
| **å¯åŠ¨é€Ÿåº¦** | ~3-5 ç§’ | ~1-2 ç§’ |
| **è¿è¡Œæ€§èƒ½** | è§£é‡Šæ‰§è¡Œ | åŸç”Ÿæœºå™¨ç  |
| **å†…å­˜å ç”¨** | è¾ƒé«˜ | è¾ƒä½ |
| **æ–‡ä»¶ä½“ç§¯** | 40-60 MB | 40-60 MB |

### å…¼å®¹æ€§
| æ–¹é¢ | PyInstaller | Nuitka |
|------|-------------|--------|
| **Python ç‰ˆæœ¬** | 3.7+ | 3.7+ |
| **ç¬¬ä¸‰æ–¹åº“** | å¹¿æ³›æ”¯æŒ | å¹¿æ³›æ”¯æŒ |
| **ç‰¹æ®Šæ¨¡å—** | éœ€è¦ hooks | éœ€è¦æ’ä»¶ |

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æœ¬åœ°æµ‹è¯•
åœ¨æ¨é€åˆ° GitHub ä¹‹å‰ï¼Œå…ˆåœ¨æœ¬åœ°æµ‹è¯• Nuitka ç¼–è¯‘ï¼š

```bash
# Windows
python build_nuitka.py

# Linux/macOS
python3 build_nuitka.py
```

### 2. å¿«é€Ÿè¿­ä»£
å¼€å‘é˜¶æ®µä½¿ç”¨å¿«é€Ÿç¼–è¯‘æ¨¡å¼ï¼š

```bash
python build_nuitka.py --fast
```

### 3. ç‰ˆæœ¬ç®¡ç†
ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼š

```bash
git tag v1.2.3
git push origin v1.2.3
```

### 4. Release è¯´æ˜
åœ¨ GitHub Release ä¸­æ·»åŠ è¯¦ç»†çš„æ›´æ–°è¯´æ˜ï¼š
- æ–°åŠŸèƒ½
- Bug ä¿®å¤
- æ€§èƒ½æ”¹è¿›
- å·²çŸ¥é—®é¢˜

## ğŸ”„ è¿ç§»æ­¥éª¤

### æ­¥éª¤ 1: å¤‡ä»½æ—§å·¥ä½œæµ
```bash
cp .github/workflows/build-multi-platform.yml .github/workflows/build-multi-platform.yml.backup
```

### æ­¥éª¤ 2: å¯ç”¨æ–°å·¥ä½œæµ
æ–°å·¥ä½œæµæ–‡ä»¶å·²åˆ›å»ºï¼š`.github/workflows/build-nuitka.yml`

### æ­¥éª¤ 3: æµ‹è¯•æ–°å·¥ä½œæµ
```bash
# åˆ›å»ºæµ‹è¯• tag
git tag v1.0.0-test
git push origin v1.0.0-test

# è§‚å¯Ÿ GitHub Actions æ‰§è¡Œæƒ…å†µ
```

### æ­¥éª¤ 4: éªŒè¯è¾“å‡º
- æ£€æŸ¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶
- æµ‹è¯•å¯åŠ¨é€Ÿåº¦
- éªŒè¯åŠŸèƒ½å®Œæ•´æ€§

### æ­¥éª¤ 5: æ­£å¼å‘å¸ƒ
```bash
# åˆ é™¤æµ‹è¯• tag
git tag -d v1.0.0-test
git push origin :refs/tags/v1.0.0-test

# åˆ›å»ºæ­£å¼ tag
git tag v1.2.0
git push origin v1.2.0
```

## ğŸ“š å‚è€ƒèµ„æ–™

- [Nuitka å®˜æ–¹æ–‡æ¡£](https://nuitka.net/doc/user-manual.html)
- [Nuitka GitHub](https://github.com/Nuitka/Nuitka)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)

## â“ å¸¸è§é—®é¢˜

### Q: å¯ä»¥åŒæ—¶ä¿ç•™ PyInstaller å’Œ Nuitka å·¥ä½œæµå—ï¼Ÿ
A: å¯ä»¥ã€‚ä¸¤ä¸ªå·¥ä½œæµå¯ä»¥å…±å­˜ï¼Œä½¿ç”¨ä¸åŒçš„è§¦å‘æ¡ä»¶æˆ–æ‰‹åŠ¨é€‰æ‹©ã€‚

### Q: Nuitka ç¼–è¯‘å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: å¯ä»¥å›é€€åˆ° PyInstaller å·¥ä½œæµï¼Œæˆ–æŸ¥çœ‹æœ¬æ–‡æ¡£çš„"æ•…éšœæ’æŸ¥"éƒ¨åˆ†ã€‚

### Q: å¦‚ä½•å‡å°‘ Nuitka ç¼–è¯‘æ—¶é—´ï¼Ÿ
A: 
- ä½¿ç”¨ `--fast` æ¨¡å¼ï¼ˆå¼€å‘é˜¶æ®µï¼‰
- ç§»é™¤ `--lto=yes` å‚æ•°ï¼ˆç‰ºç‰²ä¸€äº›æ€§èƒ½ï¼‰
- ä½¿ç”¨ ccache ç¼“å­˜ç¼–è¯‘ç»“æœ

### Q: ç”Ÿæˆçš„æ–‡ä»¶ä½“ç§¯æ¯” PyInstaller å¤§å—ï¼Ÿ
A: é€šå¸¸ç›¸è¿‘ï¼ŒNuitka å¯èƒ½ç¨å°ä¸€äº›ï¼ˆ5-10%ï¼‰ã€‚

## ğŸ‰ æ€»ç»“

è¿ç§»åˆ° Nuitka åï¼š
- âœ… è§£å†³äº† PyInstaller çš„ TOC æ ¼å¼é”™è¯¯
- âœ… æå‡äº†åº”ç”¨å¯åŠ¨é€Ÿåº¦å’Œè¿è¡Œæ€§èƒ½
- âœ… ç®€åŒ–äº†é…ç½®å’Œç»´æŠ¤
- âœ… æä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

è™½ç„¶ç¼–è¯‘æ—¶é—´ç¨é•¿ï¼Œä½†ç”Ÿæˆçš„åº”ç”¨è´¨é‡æ›´é«˜ï¼Œå€¼å¾—è¿ç§»ï¼

