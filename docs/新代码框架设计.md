# 简化版新代码框架设计

## 1. 设计原则

### 1.1 架构原则
- **简化版MVP模式**：适度分离Model、View、Presenter，避免过度复杂化
- **实用主义模块化**：必要的模块分离，但避免过度拆分
- **渐进式开发**：先实现核心功能，再逐步添加高级特性
- **可维护性优先**：清晰的代码结构，便于理解和修改

### 1.2 技术原则
- **现代化UI**：使用ttkbootstrap实现现代界面和3栏式布局
- **必要的异步处理**：仅在需要时使用后台线程
- **适度的性能优化**：图片缓存和必要的异步处理
- **基础国际化**：支持中英文切换，但不追求完整的国际化系统

### 1.3智能分片扫描：
- 大型文件夹自动分批次处理（每批500张）
- 允许用户暂停/继续扫描

### 1.4OpenCV硬件加速

### 1.5推荐技术栈
OpenCV + Pillow-SIMD	SIMD指令加速
异步处理	QThreadPool + QRunnable	原生线程管理
安装包	PyInstaller + Inno Setup	生成专业安装程序

## 2. 整体架构设计

### 2.1 简化版MVP架构
```
┌─────────────────────────────────────────────────────────────────┐
│                    Main Application                          │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │   main.py       │  │  app_model.py   │  │  main_view.py   │  │
│  │   (程序入口)    │  │   (数据模型)    │  │   (主界面)      │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Core Modules                               │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ scanner.py      │  │  ui_panels.py   │  │  helpers.py      │  │
│  │   (扫描逻辑)    │  │   (UI面板)      │  │   (工具函数)    │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ config.py       │  │ dialogs.py      │  │  i18n.py         │  │
│  │   (配置管理)    │  │   (对话框)      │  │   (国际化)      │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 简化目录结构
```
Dedup/
├── main.py                    # 程序入口和主窗口
├── app_model.py               # 核心数据模型（合并的Model层）
├── main_view.py              # 主界面和3栏布局
├── scanner.py                 # 扫描和计算逻辑
├── ui_panels.py               # UI面板组件
├── dialogs.py                 # 对话框组件
├── helpers.py                 # 合并的工具函数
├── config.py                  # 配置管理

├── i18n.py                    # 国际化支持
├── resources/                 # 资源文件
│   ├── icons/                # 图标文件
│   └── i18n/                 # 语言文件
│       ├── zh_CN.json
│       └── en_US.json
├── docs/                      # 文档
└── build/                     # 构建脚本
    ├── build_exe.py
    └── requirements.txt
```

## 3. 简化模块设计

### 3.1 核心数据模型 (app_model.py)
```python
class AppModel:
    """应用数据模型 - 合并所有数据管理功能"""
    
    def __init__(self):
        # 扫描相关
        self.scan_paths = []
        self.file_extensions = {'.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp'}
        self.sensitivity = 0.9
        self.include_subdirs = True
        self.is_scanning = False
        self.scan_progress = 0.0
        self.total_files = 0
        self.scanned_files = 0
        
        # 结果相关
        self.duplicate_groups = []
        self.selected_files = set()
        
        # 配置相关
        self.language = "zh_CN"
        self.theme = "superhero"
        self.thumbnail_size = 80
        self.image_cache = {}
        
        # 置信度计算权重
        self.confidence_weights = {
            'image_similarity': 0.6,
            'filename_similarity': 0.2,
            'filesize_similarity': 0.2
        }
    
    def add_scan_path(self, path):
        """添加扫描路径"""
        if path not in self.scan_paths:
            self.scan_paths.append(path)
    
    def remove_scan_path(self, path):
        """移除扫描路径"""
        if path in self.scan_paths:
            self.scan_paths.remove(path)
    
    def add_duplicate_group(self, files, confidence):
        """添加重复组"""
        group = {
            'id': len(self.duplicate_groups),
            'files': files,
            'confidence': confidence,
            'selected': False
        }
        self.duplicate_groups.append(group)
    
    def calculate_file_hash(self, file_path):
        """计算文件哈希值"""
        hash_md5 = hashlib.md5()
        with open(file_path, "rb") as f:
            for chunk in iter(lambda: f.read(4096), b""):
                hash_md5.update(chunk)
        return hash_md5.hexdigest()
    
    def calculate_image_similarity(self, img1_path, img2_path):
        """计算图片相似度"""
        try:
            img1 = Image.open(img1_path).convert('RGB')
            img2 = Image.open(img2_path).convert('RGB')
            
            # 调整到相同尺寸
            size = (64, 64)
            img1 = img1.resize(size)
            img2 = img2.resize(size)
            
            # 计算相似度
            arr1 = np.array(img1)
            arr2 = np.array(img2)
            similarity = np.corrcoef(arr1.ravel(), arr2.ravel())[0, 1]
            return max(0, similarity) if not np.isnan(similarity) else 0
        except Exception:
            return 0
    
    def get_thumbnail(self, file_path, size=(80, 80)):
        """获取缩略图"""
        if file_path in self.image_cache:
            return self.image_cache[file_path]
        
        try:
            img = Image.open(file_path)
            img.thumbnail(size, Image.Resampling.LANCZOS)
            photo = ImageTk.PhotoImage(img)
            self.image_cache[file_path] = photo
            return photo
        except Exception:
            return None
    
    def clear_cache(self):
        """清空缓存"""
        self.image_cache.clear()
```

### 3.2 主界面 (main_view.py)
```python
class MainView(ttkbootstrap.Window):
    """主界面 - 包含3栏式布局和所有UI组件"""
    
    def __init__(self, app_model):
        super().__init__(themename="superhero")
        self.app_model = app_model
        
        # 主要组件
        self.left_panel = None
        self.center_panel = None
        self.right_panel = None
        
        # 语言支持
        self.current_language = "zh_CN"
        self.translations = self.load_translations()
        
        self.setup_window()
        self.create_widgets()
        self.setup_layout()
        self.setup_events()
    
    def setup_window(self):
        """设置窗口"""
        self.title(self.get_text("app_title"))
        self.geometry("1400x900")
        self.minsize(1200, 700)
    
    def create_widgets(self):
        """创建主要组件"""
        # 左栏 - 文件夹选择
        self.left_panel = self.create_left_panel()
        
        # 中栏 - 进度与日志
        self.center_panel = self.create_center_panel()
        
        # 右栏 - 结果展示
        self.right_panel = self.create_right_panel()
    
    def create_left_panel(self):
        """创建左面板"""
        frame = ttkbootstrap.Frame(self)
        # 拖放区域
        drop_frame = ttkbootstrap.LabelFrame(frame, text=self.get_text("drop_folder"), padding=10)
        # 文件夹列表
        list_frame = ttkbootstrap.LabelFrame(frame, text=self.get_text("folder_list"), padding=10)
        # 设置面板
        settings_frame = ttkbootstrap.LabelFrame(frame, text=self.get_text("settings"), padding=10)
        # 控制按钮
        button_frame = ttkbootstrap.Frame(frame)
        return frame
    
    def create_center_panel(self):
        """创建中面板"""
        frame = ttkbootstrap.Frame(self)
        # 进度条
        progress_frame = ttkbootstrap.LabelFrame(frame, text=self.get_text("progress"), padding=10)
        # 统计信息
        stats_frame = ttkbootstrap.LabelFrame(frame, text=self.get_text("statistics"), padding=10)
        # 日志区域
        log_frame = ttkbootstrap.LabelFrame(frame, text=self.get_text("logs"), padding=10)
        return frame
    
    def create_right_panel(self):
        """创建右面板"""
        frame = ttkbootstrap.Frame(self)
        # 工具栏
        toolbar = ttkbootstrap.Frame(frame)
        # 结果区域
        results_frame = ttkbootstrap.Frame(frame)
        return frame
    
    def setup_layout(self):
        """设置3栏式布局"""
        # 使用grid布局创建3栏
        self.left_panel.grid(row=0, column=0, sticky="nsew", padx=5, pady=5)
        self.center_panel.grid(row=0, column=1, sticky="nsew", padx=5, pady=5)
        self.right_panel.grid(row=0, column=2, sticky="nsew", padx=5, pady=5)
        
        # 设置列权重
        self.grid_columnconfigure(0, weight=2)   # 左栏20%
        self.grid_columnconfigure(1, weight=2)   # 中栏25%
        self.grid_columnconfigure(2, weight=6)   # 右栏55%
        self.grid_rowconfigure(0, weight=1)
    
    def setup_events(self):
        """设置事件处理"""
        # 拖放事件
        self.setup_drag_drop()
        # 按钮事件
        self.setup_button_events()
    
    def setup_drag_drop(self):
        """设置拖放功能"""
        try:
            # 实现拖放逻辑
            pass
        except:
            pass
    
    def setup_button_events(self):
        """设置按钮事件"""
        # 实现按钮事件绑定
        pass
    
    def get_text(self, key):
        """获取翻译文本"""
        return self.translations.get(key, key)
    
    def load_translations(self):
        """加载翻译"""
        # 简化的翻译加载
        translations = {
            "zh_CN": {
                "app_title": "图片去重工具",
                "drop_folder": "拖放文件夹",
                "folder_list": "文件夹列表",
                "settings": "设置",
                "progress": "进度",
                "statistics": "统计",
                "logs": "日志"
            },
            "en_US": {
                "app_title": "Image Dedup Tool",
                "drop_folder": "Drop Folders",
                "folder_list": "Folder List",
                "settings": "Settings",
                "progress": "Progress",
                "statistics": "Statistics",
                "logs": "Logs"
            }
        }
        return translations.get(self.current_language, translations["zh_CN"])
```

### 3.3 扫描器 (scanner.py)
```python
class ImageScanner:
    """图片扫描器 - 处理扫描和重复检测逻辑"""
    
    def __init__(self, app_model, callback=None):
        self.app_model = app_model
        self.callback = callback
        self.scan_thread = None
        self.stop_flag = False
    
    def start_scan(self):
        """开始扫描"""
        if self.app_model.is_scanning:
            return
        
        self.stop_flag = False
        self.app_model.is_scanning = True
        self.app_model.scan_progress = 0.0
        self.app_model.duplicate_groups.clear()
        
        # 在后台线程中执行扫描
        self.scan_thread = threading.Thread(target=self._scan_worker)
        self.scan_thread.daemon = True
        self.scan_thread.start()
    
    def stop_scan(self):
        """停止扫描"""
        self.stop_flag = True
        self.app_model.is_scanning = False
    
    def _scan_worker(self):
        """扫描工作线程"""
        try:
            # 收集文件
            image_files = self._collect_image_files()
            self.app_model.total_files = len(image_files)
            
            # 计算哈希值
            hash_dict = self._calculate_hashes(image_files)
            
            # 检测重复
            self._find_duplicates(hash_dict)
            
        except Exception as e:
            self._log(f"扫描出错: {e}")
        finally:
            self.app_model.is_scanning = False
            if self.callback:
                self.callback("scan_completed")
    
    def _collect_image_files(self):
        """收集图片文件"""
        image_files = []
        for scan_path in self.app_model.scan_paths:
            for root, dirs, files in os.walk(scan_path):
                if self.stop_flag:
                    break
                
                for file in files:
                    if self.stop_flag:
                        break
                    
                    ext = os.path.splitext(file)[1].lower()
                    if ext in self.app_model.file_extensions:
                        image_files.append(os.path.join(root, file))
                        
                    # 更新进度
                    self.app_model.scanned_files = len(image_files)
                    progress = len(image_files) / max(1, len(image_files) + 100) * 50
                    self.app_model.scan_progress = progress
        
        return image_files
    
    def _calculate_hashes(self, image_files):
        """计算文件哈希值"""
        hash_dict = defaultdict(list)
        
        for i, file_path in enumerate(image_files):
            if self.stop_flag:
                break
            
            try:
                file_hash = self.app_model.calculate_file_hash(file_path)
                hash_dict[file_hash].append(file_path)
                
                # 更新进度
                progress = 50 + (i / len(image_files)) * 30
                self.app_model.scan_progress = progress
                
            except Exception as e:
                self._log(f"处理文件失败: {file_path} - {e}")
        
        return hash_dict
    
    def _find_duplicates(self, hash_dict):
        """查找重复文件"""
        exact_duplicates = []
        
        # 查找精确重复
        for file_hash, files in hash_dict.items():
            if len(files) > 1:
                exact_duplicates.append(files)
        
        # 如果敏感度小于1.0，进行相似度检测
        if self.app_model.sensitivity < 1.0 and not self.stop_flag:
            self._find_similar_images(hash_dict, exact_duplicates)
        else:
            # 直接添加精确重复
            for files in exact_duplicates:
                self.app_model.add_duplicate_group(files, 1.0)
        
        self.app_model.scan_progress = 100.0
    
    def _find_similar_images(self, hash_dict, exact_duplicates):
        """查找相似图片"""
        # 获取每个哈希组的第一个文件
        unique_files = [files[0] for files in hash_dict.values()]
        
        processed_count = 0
        total_comparisons = len(unique_files) * (len(unique_files) - 1) // 2
        
        for i in range(len(unique_files)):
            if self.stop_flag:
                break
            
            for j in range(i + 1, len(unique_files)):
                if self.stop_flag:
                    break
                
                file1 = unique_files[i]
                file2 = unique_files[j]
                
                # 检查是否已经在精确重复中
                is_exact = any(file1 in group and file2 in group for group in exact_duplicates)
                
                if not is_exact:
                    similarity = self.app_model.calculate_image_similarity(file1, file2)
                    if similarity >= self.app_model.sensitivity:
                        # 计算置信度
                        confidence = self._calculate_confidence(file1, file2, similarity)
                        self.app_model.add_duplicate_group([file1, file2], confidence)
                
                processed_count += 1
                
                # 更新进度
                progress = 80 + (processed_count / total_comparisons) * 20
                self.app_model.scan_progress = progress
    
    def _calculate_confidence(self, file1, file2, image_similarity):
        """计算置信度"""
        # 文件名相似度
        name1 = os.path.splitext(os.path.basename(file1))[0]
        name2 = os.path.splitext(os.path.basename(file2))[0]
        filename_similarity = difflib.SequenceMatcher(None, name1, name2).ratio()
        
        # 文件大小相似度
        try:
            size1 = os.path.getsize(file1)
            size2 = os.path.getsize(file2)
            filesize_similarity = min(size1, size2) / max(size1, size2)
        except:
            filesize_similarity = 0
        
        # 综合置信度
        confidence = (
            image_similarity * self.app_model.confidence_weights['image_similarity'] +
            filename_similarity * self.app_model.confidence_weights['filename_similarity'] +
            filesize_similarity * self.app_model.confidence_weights['filesize_similarity']
        )
        
        return min(1.0, max(0.0, confidence))
    
    def _log(self, message):
        """记录日志"""
        if self.callback:
            self.callback(("log", message))
```

### 3.4 UI面板 (ui_panels.py)
```python
class UIPanels:
    """UI面板组件 - 包含所有面板的实现"""
    
    def __init__(self, main_view, app_model, scanner):
        self.main_view = main_view
        self.app_model = app_model
        self.scanner = scanner
        
        # 组件引用
        self.folder_listbox = None
        self.progress_bar = None
        self.log_text = None
        self.results_frame = None
    
    def setup_left_panel(self, parent):
        """设置左面板组件"""
        # 拖放区域
        drop_label = ttkbootstrap.Label(parent, text=self.main_view.get_text("drop_folder_here"))
        drop_label.pack(pady=10)
        
        # 文件夹列表
        self.folder_listbox = tk.Listbox(parent, height=6)
        self.folder_listbox.pack(fill="both", expand=True, pady=5)
        
        # 设置面板
        ttkbootstrap.Label(parent, text="敏感度:").pack()
        sensitivity_scale = ttkbootstrap.Scale(parent, from_=0.1, to=1.0, 
                                          value=self.app_model.sensitivity,
                                          orient="horizontal")
        sensitivity_scale.pack(fill="x", pady=5)
        
        # 控制按钮
        button_frame = ttkbootstrap.Frame(parent)
        button_frame.pack(fill="x", pady=10)
        
        ttkbootstrap.Button(button_frame, text="开始扫描", 
                          command=self.start_scan).pack(side="left", padx=5)
        ttkbootstrap.Button(button_frame, text="停止扫描", 
                          command=self.stop_scan).pack(side="left", padx=5)
    
    def setup_center_panel(self, parent):
        """设置中面板组件"""
        # 进度条
        self.progress_bar = ttkbootstrap.Progressbar(parent, mode='determinate')
        self.progress_bar.pack(fill="x", pady=10)
        
        # 统计信息
        self.stats_label = ttkbootstrap.Label(parent, text="准备就绪")
        self.stats_label.pack(pady=5)
        
        # 日志区域
        self.log_text = scrolledtext.ScrolledText(parent, height=15)
        self.log_text.pack(fill="both", expand=True, pady=5)
    
    def setup_right_panel(self, parent):
        """设置右面板组件"""
        # 工具栏
        toolbar = ttkbootstrap.Frame(parent)
        toolbar.pack(fill="x", pady=5)
        
        ttkbootstrap.Button(toolbar, text="全选").pack(side="left", padx=5)
        ttkbootstrap.Button(toolbar, text="删除选中").pack(side="left", padx=5)
        ttkbootstrap.Button(toolbar, text="移动选中").pack(side="left", padx=5)
        ttkbootstrap.Button(toolbar, text="EN/中文").pack(side="right", padx=5)
        
        # 结果区域
        self.results_frame = ttkbootstrap.Frame(parent)
        self.results_frame.pack(fill="both", expand=True)
    
    def start_scan(self):
        """开始扫描"""
        self.scanner.callback = self.handle_scan_callback
        self.scanner.start_scan()
    
    def stop_scan(self):
        """停止扫描"""
        self.scanner.stop_scan()
    
    def handle_scan_callback(self, data):
        """处理扫描回调"""
        if data == "scan_completed":
            self.display_results()
        elif isinstance(data, tuple) and data[0] == "log":
            self.add_log(data[1])
    
    def update_progress(self, value):
        """更新进度"""
        if self.progress_bar:
            self.progress_bar['value'] = value
            self.main_view.update_idletasks()
    
    def add_log(self, message):
        """添加日志"""
        if self.log_text:
            timestamp = time.strftime("%H:%M:%S")
            self.log_text.insert(tk.END, f"[{timestamp}] {message}\n")
            self.log_text.see(tk.END)
            self.main_view.update_idletasks()
    
    def display_results(self):
        """显示结果"""
        # 清空结果区域
        for widget in self.results_frame.winfo_children():
            widget.destroy()
        
        # 显示重复组
        for group in self.app_model.duplicate_groups:
            self.create_group_row(group)
    
    def create_group_row(self, group):
        """创建重复组行"""
        group_frame = ttkbootstrap.LabelFrame(self.results_frame, 
                                            text=f"重复组 {group['id']+1} (置信度: {group['confidence']:.2f})")
        group_frame.pack(fill="x", pady=5, padx=5)
        
        # 显示图片
        image_frame = ttkbootstrap.Frame(group_frame)
        image_frame.pack(fill="x", pady=5)
        
        for file_path in group['files']:
            self.create_thumbnail_item(image_frame, file_path)
    
    def create_thumbnail_item(self, parent, file_path):
        """创建缩略图项"""
        item_frame = ttkbootstrap.Frame(parent)
        item_frame.pack(side="left", padx=5)
        
        # 缩略图
        thumbnail = self.app_model.get_thumbnail(file_path)
        if thumbnail:
            img_label = ttkbootstrap.Label(item_frame, image=thumbnail)
            img_label.image = thumbnail  # 保持引用
            img_label.pack()
        
        # 文件名
        file_name = os.path.basename(file_path)
        if len(file_name) > 15:
            file_name = file_name[:12] + "..."
        ttkbootstrap.Label(item_frame, text=file_name, wraplength=80).pack()
```

### 3.5 对话框 (dialogs.py)
```python
class Dialogs:
    """对话框组件"""
    
    @staticmethod
    def show_about(parent):
        """显示关于对话框"""
        about_text = """图片去重工具 v1.0
        
一个现代化的图片去重工具，帮助您快速找到并处理重复图片。

主要功能：
• 多文件夹扫描
• 智能重复检测
• 置信度评估
• 批量处理"""
        messagebox.showinfo("关于", about_text)
    
    @staticmethod
    def show_settings(parent):
        """显示设置对话框"""
        # 简化的设置对话框
        settings_window = tk.Toplevel(parent)
        settings_window.title("设置")
        settings_window.geometry("300x200")
        
        ttkbootstrap.Label(settings_window, text="缩略图大小:").pack(pady=5)
        size_var = tk.StringVar(value="80")
        size_combo = ttkbootstrap.Combobox(settings_window, textvariable=size_var,
                                          values=["60", "80", "100", "120"])
        size_combo.pack(pady=5)
        
        def apply_settings():
            # 应用设置
            settings_window.destroy()
        
        ttkbootstrap.Button(settings_window, text="应用", 
                          command=apply_settings).pack(pady=10)
    
    @staticmethod
    def select_folder():
        """选择文件夹对话框"""
        return filedialog.askdirectory(title="选择文件夹")
    
    @staticmethod
    def select_save_folder():
        """选择保存文件夹对话框"""
        return filedialog.askdirectory(title="选择保存位置")
```

### 3.6 工具函数 (helpers.py)
```python
class Helpers:
    """工具函数集合"""
    
    @staticmethod
    def format_file_size(size_bytes):
        """格式化文件大小"""
        if size_bytes < 1024:
            return f"{size_bytes} B"
        elif size_bytes < 1024 * 1024:
            return f"{size_bytes / 1024:.1f} KB"
        else:
            return f"{size_bytes / (1024 * 1024):.1f} MB"
    
    @staticmethod
    def run_in_thread(target, callback=None):
        """在后台线程中运行函数"""
        thread = threading.Thread(target=target)
        thread.daemon = True
        thread.start()
        return thread
    
    @staticmethod
    def run_in_main_thread(func):
        """在主线程中运行函数"""
        if hasattr(func, '__call__'):
            func()
    
    @staticmethod
    def delete_files(file_paths):
        """删除文件"""
        deleted_count = 0
        for file_path in file_paths:
            try:
                os.remove(file_path)
                deleted_count += 1
            except Exception as e:
                print(f"删除文件失败: {file_path} - {e}")
        return deleted_count
    
    @staticmethod
    def move_files(file_paths, target_dir):
        """移动文件"""
        moved_count = 0
        os.makedirs(target_dir, exist_ok=True)
        
        for file_path in file_paths:
            try:
                file_name = os.path.basename(file_path)
                target_path = os.path.join(target_dir, file_name)
                
                # 处理文件名冲突
                counter = 1
                while os.path.exists(target_path):
                    name, ext = os.path.splitext(file_name)
                    target_path = os.path.join(target_dir, f"{name}_{counter}{ext}")
                    counter += 1
                
                shutil.move(file_path, target_path)
                moved_count += 1
            except Exception as e:
                print(f"移动文件失败: {file_path} - {e}")
        
        return moved_count
```

### 3.7 配置管理 (config.py)
```python
class Config:
    """配置管理"""
    
    def __init__(self):
        self.config_file = "config.json"
        self.config = self.load_config()
    
    def load_config(self):
        """加载配置"""
        default_config = {
            "language": "zh_CN",
            "theme": "superhero",
            "thumbnail_size": 80,
            "sensitivity": 0.9,
            "include_subdirs": True
        }
        
        try:
            if os.path.exists(self.config_file):
                with open(self.config_file, 'r', encoding='utf-8') as f:
                    return json.load(f)
        except:
            pass
        
        return default_config
    
    def save_config(self):
        """保存配置"""
        try:
            with open(self.config_file, 'w', encoding='utf-8') as f:
                json.dump(self.config, f, ensure_ascii=False, indent=2)
        except Exception as e:
            print(f"保存配置失败: {e}")
    
    def get(self, key, default=None):
        """获取配置值"""
        return self.config.get(key, default)
    
    def set(self, key, value):
        """设置配置值"""
        self.config[key] = value
        self.save_config()
```

### 3.8 国际化 (i18n.py)
```python
class I18n:
    """国际化支持"""
    
    def __init__(self):
        self.current_language = "zh_CN"
        self.translations = self._load_translations()
    
    def _load_translations(self):
        """加载翻译"""
        return {
            "zh_CN": {
                "app_title": "图片去重工具",
                "drop_folder_here": "拖放文件夹到此处",
                "folder_list": "文件夹列表",
                "settings": "设置",
                "progress": "进度",
                "statistics": "统计",
                "logs": "日志",
                "start_scan": "开始扫描",
                "stop_scan": "停止扫描",
                "select_all": "全选",
                "delete_selected": "删除选中",
                "move_selected": "移动选中",
                "about": "关于",
                "settings": "设置"
            },
            "en_US": {
                "app_title": "Image Dedup Tool",
                "drop_folder_here": "Drop folders here",
                "folder_list": "Folder List",
                "settings": "Settings",
                "progress": "Progress",
                "statistics": "Statistics",
                "logs": "Logs",
                "start_scan": "Start Scan",
                "stop_scan": "Stop Scan",
                "select_all": "Select All",
                "delete_selected": "Delete Selected",
                "move_selected": "Move Selected",
                "about": "About",
                "settings": "Settings"
            }
        }
    
    def get_text(self, key):
        """获取翻译文本"""
        return self.translations[self.current_language].get(key, key)
    
    def set_language(self, language):
        """设置语言"""
        if language in self.translations:
            self.current_language = language
            return True
        return False
```

## 4. 简化的数据流设计

### 4.1 启动流程
1. **main.py** 创建应用程序实例
2. 初始化 **AppModel**（数据模型）
3. 创建 **MainView**（主界面）
4. 连接 **ImageScanner**（扫描逻辑）
5. 设置 **UIPanels**（界面交互）

### 4.2 扫描流程
1. 用户添加文件夹 → **AppModel**
2. **ImageScanner** 开始扫描（后台线程）
3. 扫描进度实时更新到 **UIPanels**
4. 结果存储到 **AppModel**
5. **UIPanels** 显示重复图片

### 4.3 操作流程
1. 用户选择图片 → **AppModel**
2. **Helpers** 执行删除/移动操作
3. **AppModel** 更新状态
4. **UIPanels** 刷新显示

## 5. 简化的性能优化

### 5.1 图片缓存
- 使用字典缓存缩略图
- 限制缓存数量（最多100张）
- 提供手动清理按钮

### 5.2 异步处理
- 扫描使用独立线程
- 进度通过回调更新
- 避免界面卡顿

### 5.3 内存管理
- 及时释放不用的图片资源
- 分批加载大量图片
- 提供内存占用指示器

## 6. 简化的国际化

### 6.1 翻译实现
- 使用内置字典存储翻译
- 支持中英文切换
- 简单的键值查找机制

### 6.2 语言切换
- 一键切换语言
- 无需重启应用
- 自动更新界面文本

## 7. 开发周期调整

### 7.1 缩短开发周期
- 从14周缩减到6-8周
- 采用敏捷开发模式
- 每2周一个迭代

### 7.2 开发计划
- **第1-2周**：核心框架和3栏式UI
- **第3-4周**：扫描逻辑和重复检测
- **第5-6周**：批量操作和性能优化
- **第7-8周**：测试、优化和完善

### 7.3 功能优先级
- **P0（必须）**：3栏式UI、多文件夹选择、基本去重
- **P1（重要）**：拖放操作、置信度显示、批量处理
- **P2（可选）**：高级设置、主题切换、更多文件格式支持

## 8. 总结

这个简化版的代码框架设计避免了过度工程化，具有以下特点：

1. **架构简化**：采用简化版MVP模式，减少不必要的复杂性
2. **模块合理**：8个核心模块覆盖所有功能，避免过度拆分
3. **实用优先**：专注于核心去重功能，去除不必要的扩展
4. **UI现代**：使用ttkbootstrap实现3栏式布局，提升用户体验
5. **性能适中**：保留必要的缓存和异步处理，避免过度优化
6. **开发高效**：6-8周完成开发，支持快速迭代

这个简化框架非常适合图片去重工具这种中小型桌面应用，既能提供现代化的用户界面和良好的代码组织，又避免了过度设计带来的复杂性，显著提高了开发效率和可维护性。